<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>DSU 랜덤 매칭 아이디·비밀번호 찾기</title>

  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Animate.css -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <!-- Pretendard & Montserrat 폰트 -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Pretendard:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    html, body {
      min-height: 100%;
      background: linear-gradient(135deg, #667eea 0%, #e9d0ff 100%);
      margin: 0; padding: 0;
      font-family: 'Pretendard', 'Montserrat', 'Segoe UI', Arial, sans-serif;
      overflow-x: hidden;
    }
    #particles-js {
      position: fixed;
      width: 100vw;
      height: 100vh;
      top: 0; left: 0;
      z-index: 1;
      pointer-events: none;
    }
    .login-card {
      z-index: 10;
      position: relative;
      max-width: 560px;
      min-width: 350px;
      width: 100%;
      margin: 6vh auto 0 auto;
      background: rgba(255,255,255,0.97);
      border-radius: 2.5rem;
      box-shadow: 0 16px 60px 0 #a48fcd1f, 0 2px 16px #e3b2fb2b;
      padding: 3.3rem 2.5rem 2.7rem 2.5rem;
      animation: fadein 1s;
      backdrop-filter: blur(2px);
      display: flex;
      flex-direction: column;
    }
    @keyframes fadein {
      from { opacity: 0; transform: translateY(48px);}
      to   { opacity: 1; transform: none;}
    }
    .brand-title {
      text-align: center;
      font-size: 2.3rem;
      font-weight: 800;
      font-family: 'Montserrat', 'Pretendard', Arial, sans-serif;
      color: #726be5;
      letter-spacing: 1.3px;
      margin-bottom: 0.6rem;
      margin-top: 0.1rem;
      text-shadow: 0 2px 18px #ddd1f31b;
    }
    .page-title {
      text-align: center;
      color: #8b6adf;
      font-weight: 700;
      font-size: 1.22rem;
      letter-spacing: 0.6px;
      margin-bottom: 1.7rem;
    }
    .section-title {
      text-align: center;
      color: #6c5bd7;
      font-weight: 800;
      font-size: 1.35rem;
      letter-spacing: 0.4px;
      margin-top: 0.2rem;
      margin-bottom: 1.2rem;
    }

    .form-label, label {
      font-weight: 600;
      color: #8561d6;
      font-size: 1.06rem;
      letter-spacing: 0.2px;
      margin-bottom: 0.22rem;
    }
    .form-control {
      border-radius: 1.2rem;
      border: 1.5px solid #ece2fa;
      background: #f8f5fd;
      font-size: 1.05rem;
      padding: 1.02rem 1.1rem;
      margin-bottom: 1.05rem;
      font-family: 'Pretendard', Arial, sans-serif;
      box-shadow: none;
      transition: border-color .16s, box-shadow .16s;
    }
    .form-control:focus {
      border-color: #c0a6e4;
      background: #fff;
      box-shadow: 0 0 0 1.2px #bbbefa33;
    }

    .login-btn {
      font-family: 'Montserrat', 'Pretendard', Arial, sans-serif;
      font-weight: 800;
      font-size: 1.12rem;
      border-radius: 2rem;
      padding: 0.92rem;
      margin-bottom: 0.6rem;
      background: linear-gradient(90deg, #8d87e3 0%, #c18ef9 100%);
      border: none;
      transition: background 0.19s, box-shadow 0.17s, transform 0.13s;
      box-shadow: 0 4px 24px #a78cfa19;
      letter-spacing: 1.2px;
      color: #fff;
      animation: pulse 1.3s infinite;
      width: 100%;
    }
    @keyframes pulse {
      0% {box-shadow: 0 4px 24px #a78cfa17;}
      50% {box-shadow: 0 7px 34px #d1a2fa25;}
      100% {box-shadow: 0 4px 24px #a78cfa17;}
    }
    .login-btn:hover {
      background: linear-gradient(90deg, #c18ef9 0%, #8d87e3 100%);
      color: #fff;
      transform: scale(1.02);
      box-shadow: 0 10px 34px 0 #cfbcf729;
    }

    /* ✅ 결과 박스(기본) */
    .result-box {
      display: none;
      padding: 1.05rem 1.2rem;
      border-radius: 1.2rem;
      margin-top: 1.1rem;
      text-align: center;
      font-weight: 800;
      letter-spacing: 0.2px;
      line-height: 1.35;
      position: relative;
      overflow: hidden;
      transform: translateY(6px);
      opacity: 0;
      transition: opacity .18s ease, transform .18s ease;
    }
    .result-box.show {
      display: block;
      opacity: 1;
      transform: translateY(0);
    }

    /* ✅ 성공 스타일 */
    .result-success {
      background: linear-gradient(90deg, #f5efff 0%, #ffffff 55%, #f5efff 100%);
      border: 1.6px solid #eadcff;
      box-shadow: 0 14px 30px rgba(120, 90, 210, 0.14);
      color: #4a3a6d;
    }
    .result-success::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 30% 20%, rgba(193, 142, 249, 0.25), transparent 55%);
      pointer-events: none;
    }

    /* ✅ 실패 스타일 */
    .result-fail {
      background: linear-gradient(90deg, #fff1f1 0%, #ffffff 55%, #fff1f1 100%);
      border: 1.6px solid #ffd0d0;
      box-shadow: 0 14px 30px rgba(230, 70, 70, 0.12);
      color: #b42323;
    }
    .result-fail::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 30% 20%, rgba(255, 120, 120, 0.22), transparent 55%);
      pointer-events: none;
    }

    /* ✅ 결과 텍스트/아이콘 */
    .result-icon {
      font-size: 1.35rem;
      margin-right: 0.35rem;
      vertical-align: -2px;
    }
    .result-msg {
      position: relative;
      z-index: 1;
      font-size: 1.07rem;
      word-break: keep-all;
    }
    .result-sub {
      position: relative;
      z-index: 1;
      margin-top: 0.45rem;
      font-weight: 600;
      font-size: 0.95rem;
      opacity: 0.85;
    }

    hr {
      margin: 2rem 0;
      border-top: 1px solid #eee2fb;
      opacity: 1;
    }

    .back-link {
      color: #a57cd3;
      font-size: 1.14rem;
      text-decoration: none;
      transition: color 0.2s;
      margin-bottom: 1.5rem;
      display: inline-block;
      font-weight: 600;
      margin-left: 0.1rem;
    }
    .back-link:hover {
      color: #7c4de7;
      text-decoration: underline;
    }

    .sub-actions {
      display: flex;
      justify-content: space-between;
      margin-top: 1rem;
      font-size: 1.02rem;
    }
    .sub-actions a {
      color: #a57cd3;
      text-decoration: none;
      transition: color 0.2s;
      font-weight: 500;
      letter-spacing: 0.6px;
    }
    .sub-actions a:hover {
      color: #6352b6;
      text-decoration: underline;
    }

    .login-footer {
      text-align: center;
      margin-top: 2.2rem;
      color: #bbb;
      font-size: 1.02rem;
      letter-spacing: 0.19px;
    }

    @media (max-width: 600px) {
      .login-card { max-width: 97vw; padding: 1.1rem 0.6rem 0.9rem 0.6rem; }
      .brand-title { font-size: 1.3rem; }
    }
  </style>
</head>

<body>
  <div id="particles-js"></div>

  <div class="login-card animate__animated animate__fadeInDown">
    <a href="#"
       class="back-link animate__animated animate__fadeInLeft"
       onclick="event.preventDefault(); history.back();">
      &lt; 돌아가기
    </a>

    <div class="brand-title animate__animated animate__fadeIn">DSU School Matcher</div>
    <div class="page-title">아이디 · 비밀번호 찾기</div>

    <!-- 아이디 찾기 -->
    <div class="section-title">아이디 찾기</div>
    <form onsubmit="return findId(event);" autocomplete="on">
      <div class="mb-2">
        <label for="id-name">이름</label>
        <input type="text" id="id-name" class="form-control" required placeholder="이름을 입력하세요" autocomplete="name">
      </div>
      <div class="mb-2">
        <label for="id-phone">전화번호</label>
        <input type="text" id="id-phone" class="form-control" required placeholder="010-0000-0000" autocomplete="tel">
      </div>
      <button type="submit" class="login-btn animate__animated animate__pulse animate__infinite animate__slow">
        아이디 찾기
      </button>
    </form>

    <!-- ✅ 결과 박스 -->
    <div id="resultBoxId" class="result-box" aria-live="polite"></div>

    <hr>

    <!-- 비밀번호 찾기 -->
    <div class="section-title" style="font-size: 1.25rem;">비밀번호 찾기</div>
    <form onsubmit="return findPassword(event);" autocomplete="on">
      <div class="mb-2">
        <label for="pw-userId">아이디</label>
        <input type="text" id="pw-userId" class="form-control" required placeholder="아이디를 입력하세요" autocomplete="username">
      </div>
      <div class="mb-2">
        <label for="pw-name">이름</label>
        <input type="text" id="pw-name" class="form-control" required placeholder="이름을 입력하세요" autocomplete="name">
      </div>
      <div class="mb-2">
        <label for="pw-phone">전화번호</label>
        <input type="text" id="pw-phone" class="form-control" required placeholder="010-0000-0000" autocomplete="tel">
      </div>
      <button type="submit" class="login-btn animate__animated animate__pulse animate__infinite animate__slow">
        비밀번호 찾기
      </button>
    </form>

    <!-- ✅ 결과 박스 -->
    <div id="resultBoxPw" class="result-box" aria-live="polite"></div>

    <div class="sub-actions">
      <a href="/signup">회원가입</a>
      <a href="/login">로그인</a>
    </div>

    <div class="login-footer">ⓒ 2025 DSU School Matcher.</div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- particles.js -->
  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>

  <script>
    // ✅ 메시지로 성공/실패 판단(서버가 text만 보내는 구조라 키워드 기반)
    function isFailMessage(msg) {
      if (!msg) return true;
      const m = String(msg).trim().toLowerCase();

      // 흔한 실패/오류 키워드들 (필요하면 추가 가능)
      const failKeywords = [
        "없", "존재하지", "찾을 수", "일치하지", "실패", "오류", "에러",
        "not found", "no user", "invalid", "fail", "error"
      ];

      return failKeywords.some(k => m.includes(k));
    }

    // ✅ 결과 박스 렌더링(성공/실패 스타일 자동 적용)
    function showResult(box, msg, { successTitle, failTitle } = {}) {
      const text = (msg ?? "").toString().trim();

      // 초기화
      box.className = "result-box";
      box.innerHTML = "";
      box.style.display = "none";
      box.classList.remove("show");

      const fail = isFailMessage(text);
      const icon = fail ? "⚠️" : "✅";
      const title = fail ? (failTitle || "조회 실패") : (successTitle || "조회 성공");

      box.classList.add(fail ? "result-fail" : "result-success");
      box.innerHTML = `
        <div class="result-msg">
          <span class="result-icon">${icon}</span>${title}
        </div>
        <div class="result-sub">${text || (fail ? "정보를 확인할 수 없어요. 입력값을 다시 확인해 주세요." : "요청이 완료되었어요.")}</div>
      `;

      // 표시 애니메이션
      box.style.display = "block";
      requestAnimationFrame(() => box.classList.add("show"));
    }

    // ✅ 요청 시작 시 이전 결과 숨김
    function clearResult(box) {
      box.className = "result-box";
      box.innerHTML = "";
      box.style.display = "none";
      box.classList.remove("show");
    }

    function findId(event) {
      event.preventDefault();

      const name  = document.getElementById("id-name").value;
      const phone = document.getElementById("id-phone").value;
      const box = document.getElementById("resultBoxId");

      clearResult(box);
      showResult(box, "조회 중입니다...", { successTitle: "처리 중", failTitle: "처리 중" });
      box.classList.remove("result-fail");
      box.classList.add("result-success");

      fetch("/find-id", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: `name=${encodeURIComponent(name)}&phone=${encodeURIComponent(phone)}`
      })
      .then(res => res.text())
      .then(msg => showResult(box, msg, { successTitle: "아이디 찾기 완료", failTitle: "아이디 찾기 실패" }))
      .catch(() => showResult(box, "요청 중 오류가 발생했어요. 잠시 후 다시 시도해 주세요.", { failTitle: "오류" }));

      return false;
    }

    function findPassword(event) {
      event.preventDefault();

      const userId = document.getElementById("pw-userId").value;
      const name   = document.getElementById("pw-name").value;
      const phone  = document.getElementById("pw-phone").value;
      const box = document.getElementById("resultBoxPw");

      clearResult(box);
      showResult(box, "조회 중입니다...", { successTitle: "처리 중", failTitle: "처리 중" });
      box.classList.remove("result-fail");
      box.classList.add("result-success");

      fetch("/find-password", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: `userId=${encodeURIComponent(userId)}&name=${encodeURIComponent(name)}&phone=${encodeURIComponent(phone)}`
      })
      .then(res => res.text())
      .then(msg => showResult(box, msg, { successTitle: "비밀번호 찾기 완료", failTitle: "비밀번호 찾기 실패" }))
      .catch(() => showResult(box, "요청 중 오류가 발생했어요. 잠시 후 다시 시도해 주세요.", { failTitle: "오류" }));

      return false;
    }
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      particlesJS("particles-js", {
        "particles": {
          "number": { "value": 34, "density": { "enable": true, "value_area": 800 } },
          "color": { "value": ["#c1bbef", "#e5ddfb", "#fff", "#b3a9e6"] },
          "shape": { "type": "circle" },
          "opacity": {
            "value": 0.20,
            "random": true,
            "anim": { "enable": true, "speed": 0.6, "opacity_min": 0.1, "sync": false }
          },
          "size": {
            "value": 18,
            "random": true,
            "anim": { "enable": false, "speed": 10, "size_min": 7, "sync": false }
          },
          "line_linked": { "enable": false },
          "move": {
            "enable": true,
            "speed": 1.2,
            "direction": "top",
            "random": true,
            "straight": false,
            "out_mode": "out",
            "bounce": false
          }
        },
        "interactivity": {
          "detect_on": "canvas",
          "events": { "onhover": {"enable": false}, "onclick": {"enable": false}, "resize": true }
        },
        "retina_detect": true
      });
    });
  </script>
</body>
</html>
